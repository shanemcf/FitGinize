(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{135:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(3),i=n.n(r),c=n(2),s=n(440),u=n(435),l=n(652);function d(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function m(t,e){t[0].target.classList.contains("authenticated")&&sessionStorage.removeItem("commentLogin"),t[0].target.classList.contains("modal-active")&&(sessionStorage.removeItem("ratingValue"),e.disconnect())}function g(t){var e=sessionStorage.getItem(t),n=document.querySelector(".ugc-comments-content-container");if(e&&n){var a=n.getBoundingClientRect().top-document.querySelector("header.navigation-test").offsetHeight;window.scrollBy(0,a),function(t){var e=sessionStorage.getItem(t),n=document.getElementById("project-ratings");e&&n&&(o()(".ugc-comments-add-comment").trigger("click"),document.querySelector(".ugc-upload-modal").querySelector("input[value=".concat(e,"]")).checked=!0)}("ratingValue"),new MutationObserver(m).observe(document.body,{attributes:!0})}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$context=e,this.$form=e.find("form"),this.$alert=e.find(".alert-banner");var n=e.closest(".ugc-upload-reply-modal");n.length?(this.$trigger=o()(".ugc-comments-reply-button"),this.ugcUploadModal=new s.a(n,"ugc-upload-reply-modal")):(this.$trigger=o()(".recipe-review-add-review, .ugc-comments-add-comment"),this.ugcUploadModal=new s.a(e.closest(".ugc-upload-modal"),"ugc-upload-modal")),this.useUGCManager=!!this.$form.closest(".ugc-upload").data("ugc-manager")&&this.$form.closest(".ugc-upload").data("ugc-manager"),this.ugcType=this.$trigger.hasClass("recipe-review-add-review")&&!this.useUGCManager?"review":"comments",g("commentLogin")}var e,n,a;return e=t,(n=[{key:"showError",value:function(t){this.$alert.removeClass("hidden"),this.$alert.find(".alert-text").text(t)}},{key:"hideError",value:function(){this.$alert.addClass("hidden"),this.$alert.find(".alert-text").text("")}},{key:"uploadComment",value:function(t,e){var n=this,a=Object(u.a)("/element-api/content-proxy/comment"),r=t;r.title=this.$context.data("headline"),(r.text||r.rating)&&o.a.post(a,r,(function(t,e){if("success"===e){n.$context.addClass("submitted"),n.hideError();var a=o()("textarea",n.$form);a.length&&a.val(""),r.text&&i()(c.dc).broadcast(t,r),r.rating&&i()(c.ec).broadcast(t,r)}})).fail((function(a){500!==a.status||e?n.showError("An error has occurred."):500!==a.status||e||Object(l.a)(n.uploadComment.bind(n),[t])}))}},{key:"uploadReview",value:function(t,e){var n=this,a=Object(u.a)("/element-api/content-proxy/review");o.a.post(a,t,(function(e,a){if("success"===a){n.$context.addClass("submitted");var o={label:"Rating Submitted"};t.text&&(o.label="Review Submitted"),i()(c.ac).broadcast(o),n.hideError()}})).fail((function(a){500!==a.status||e?n.showError("An error has occurred."):500!==a.status||e||Object(l.a)(n.uploadReview.bind(n),[t])}))}},{key:"events",value:function(){var t=this;document.body.addEventListener(c.e,(function(e){var n=sessionStorage.getItem("ratingValue"),a=sessionStorage.getItem("commentLogin");(n||a)&&setTimeout(i()(c.hc).broadcast(e,t.$trigger),0)})),i()(c.hc).subscribe((function(e,n){if(o()("body").hasClass("authenticated"))e.preventDefault(),t.pid=n.data("tid")?n.data("tid"):"0","review"===t.ugcType&&t.$form.trigger("reset"),t.$context.removeClass("submitted"),t.hideError(),t.ugcUploadModal.open(),i()(c.Hb).broadcast(t.ugcUploadModal.$modal,n.closest(".rating-star").data("rating")),window.ugcUploadModal=t.ugcUploadModal;else if(sessionStorage.setItem("commentLogin",!0),!n.closest(".embedded-auth-modal-trigger").length){var a=n.closest(t.$trigger).data("login-url")||n.data("login-url")||n.closest("button").data("login-url");window.open(a,"_self")}})),i()(c.o).subscribe((function(e,n){n.closest(t.$trigger).length&&i()(c.hc).broadcast(e,n)})),i()(c.Mb).subscribe((function(e,n){if(n.closest(t.$form).length){e.preventDefault();var a=t.$form.find("input[name=ugc-rating]:checked").val()||t.$form.find("input[name=ugc-comments-rating]:checked").val(),r=a,i=t.$form.find("textarea[name=ugc-text]").val()?t.$form.find("textarea[name=ugc-text]").val():"",c=t.$form.closest(".ugc-upload"),s=c.data("review"===t.ugcType?"cms-id":"uuid"),u=c.data("ugc-type")||"ugc-comment",l=t.$context.find(".ugc-upload-rating").length,d=t.pid,m=o()("body")[0].className.match(/(^|\s+)template-(\S*)/)[2];a&&s&&"review"===t.ugcType?t.uploadReview({rating:a,text:i,id:s}):l&&!a||!s?t.showError("Please select a rating."):i||l?t.uploadComment({rating:a,level_of_difficulty:r,text:i,id:s,pid:d,_type:u,template:m}):t.showError("Please enter a comment.")}}))}},{key:"init",value:function(){this.events()}}])&&d(e.prototype,n),a&&d(e,a),t}();e.default=function(){o()(".component.ugc-upload").each((function(){new f(o()(this)).init()}))}},435:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n(1),o=n.n(a),r=n(0),i=n.n(r);function c(t){return i()(document.body).data("add-slash")&&!o.a.endsWith(t,"/")?"".concat(t,"/"):t}},652:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n(1),o=n.n(a),r=n(0),i=n.n(r),c=n(435);function s(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function l(t,e){var n=Object(c.a)("/element-api/content-proxy/refresh-cookie");i.a.ajax({url:n,retry:!1,type:"GET",timeout:3e3,xhrFields:{withCredentials:!0},success:function(n){o.a.isArray(n)&&"function"==typeof t&&(o.a.forEach(n,(function(t){document.cookie=t})),t.apply(void 0,s(e).concat([!0])))}})}}}]);
//# sourceMappingURL=57-57.js.map